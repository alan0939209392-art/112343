<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>居家與愛車管家</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 自定義樣式 -->
    <style>
        body {
            background-color: #0f172a; /* Slate 900 */
            -webkit-tap-highlight-color: transparent;
        }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 20px); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        
        @keyframes wave { 
            0%, 100% { transform: translateX(-25%); } 
            50% { transform: translateX(0%); } 
        }
        .animate-wave { animation: wave 3s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons Components (SVG) ---
        const IconBase = ({ d, className, ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                {...props}
            >
                {d}
            </svg>
        );

        const Icons = {
            Droplets: (props) => <IconBase d={<><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.35"/></>} {...props} />,
            RotateCcw: (props) => <IconBase d={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>} {...props} />,
            AlertTriangle: (props) => <IconBase d={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></>} {...props} />,
            X: (props) => <IconBase d={<><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>} {...props} />,
            Bike: (props) => <IconBase d={<><circle cx="5.5" cy="17.5" r="3.5"/><circle cx="18.5" cy="17.5" r="3.5"/><path d="M15 6h-5a1 1 0 0 0-1 1v4l-3 4.5"/><path d="M12 17.5V14l-3-3 4-3 2 3h2"/></>} {...props} />,
            History: (props) => <IconBase d={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></>} {...props} />,
            CheckCircle2: (props) => <IconBase d={<><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></>} {...props} />,
            Trash2: (props) => <IconBase d={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} {...props} />,
            User: (props) => <IconBase d={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} {...props} />,
            Plus: (props) => <IconBase d={<><path d="M5 12h14"/><path d="M12 5v14"/></>} {...props} />,
            PenTool: (props) => <IconBase d={<><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></>} {...props} />,
            Calendar: (props) => <IconBase d={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>} {...props} />,
            Info: (props) => <IconBase d={<><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>} {...props} />,
        };

        // --- Constants & Defaults ---

        const DEFAULT_FILTERS = [
            { id: 1, name: "第一道 PP 棉", lifespanMonths: 3, description: "阻擋泥沙雜質", type: 'pp' },
            { id: 2, name: "第二道 活性碳", lifespanMonths: 6, description: "吸附氯氣異味", type: 'carbon' },
            { id: 3, name: "第三道 RO 膜", lifespanMonths: 24, description: "核心過濾重金屬", type: 'ro' },
            { id: 4, name: "第四道 後置碳", lifespanMonths: 12, description: "調整口感甘甜", type: 'post' },
        ];

        const DEFAULT_SCOOTERS = [
            { 
                id: 1, 
                owner: "我的愛車", 
                plateNumber: "ABC-123", 
                licenseMonth: 7, 
                lastInspection: new Date().toISOString().split('T')[0] 
            }
        ];

        // --- Main App Component ---

        function App() {
            // --- State ---
            const [activeTab, setActiveTab] = useState('water');
            
            // RO State
            const [filters, setFilters] = useState([]);
            const [filterHistory, setFilterHistory] = useState([]);
            const [selectedFilter, setSelectedFilter] = useState(null);
            const [replacerName, setReplacerName] = useState(''); 
            
            // Moto State
            const [scooters, setScooters] = useState([]);
            const [motoHistory, setMotoHistory] = useState([]);
            const [selectedScooter, setSelectedScooter] = useState(null); 
            const [showMotoModal, setShowMotoModal] = useState(false);
            const [isAddingScooter, setIsAddingScooter] = useState(false); 

            // Temp State
            const [tempDate, setTempDate] = useState('');
            const [tempOwner, setTempOwner] = useState(''); 
            const [tempPlate, setTempPlate] = useState(''); 
            const [tempLicenseMonth, setTempLicenseMonth] = useState(1);

            // --- Initialization & Storage ---
            
            useEffect(() => {
                // Initialize Filters
                const savedFilters = localStorage.getItem('ro_filters_v6');
                const savedFilterHistory = localStorage.getItem('ro_history_v6');
                setFilters(savedFilters ? JSON.parse(savedFilters) : initFilters());
                setFilterHistory(savedFilterHistory ? JSON.parse(savedFilterHistory) : []);

                // Initialize Scooters
                const savedScooters = localStorage.getItem('moto_data_v4');
                const savedMotoHistory = localStorage.getItem('moto_history_v4');
                setScooters(savedScooters ? JSON.parse(savedScooters) : DEFAULT_SCOOTERS);
                setMotoHistory(savedMotoHistory ? JSON.parse(savedMotoHistory) : []);
            }, []);

            useEffect(() => {
                localStorage.setItem('ro_filters_v6', JSON.stringify(filters));
                localStorage.setItem('ro_history_v6', JSON.stringify(filterHistory));
                localStorage.setItem('moto_data_v4', JSON.stringify(scooters));
                localStorage.setItem('moto_history_v4', JSON.stringify(motoHistory));
            }, [filters, filterHistory, scooters, motoHistory]);

            const initFilters = () => {
                const today = new Date().toISOString().split('T')[0];
                return DEFAULT_FILTERS.map(f => ({ ...f, lastReplaced: today }));
            };

            // --- Logic Helpers ---

            const calculateFilterStatus = (lastReplaced, lifespanMonths) => {
                const last = new Date(lastReplaced);
                const due = new Date(last);
                due.setMonth(due.getMonth() + lifespanMonths);
                const today = new Date();
                const diffTime = due.getTime() - today.getTime();
                const daysRemaining = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const totalDays = lifespanMonths * 30; 
                let percent = Math.min(100, Math.max(0, (daysRemaining / totalDays) * 100));
                let status = 'good';
                if (daysRemaining < 0) status = 'expired';
                else if (daysRemaining < 20) status = 'warning';
                return { daysRemaining, percent, status, dueDate: due.toISOString().split('T')[0] };
            };

            const calculateMotoStatus = (lastInspectionDateStr, licenseMonth) => {
                const today = new Date();
                const currentYear = today.getFullYear();
                const lastInspection = new Date(lastInspectionDateStr);
                const targetMonthIndex = licenseMonth - 1; 

                const getWindowForYear = (year) => {
                    const start = new Date(year, targetMonthIndex - 1, 1);
                    const end = new Date(year, targetMonthIndex + 2, 0, 23, 59, 59);
                    return { start, end };
                };

                const thisYearWindow = getWindowForYear(currentYear);
                const isDoneForThisYear = lastInspection >= thisYearWindow.start;

                let targetYear;
                if (isDoneForThisYear) {
                    targetYear = currentYear + 1;
                } else {
                    targetYear = currentYear;
                    if (today < thisYearWindow.start) {
                        const lastYearWindow = getWindowForYear(currentYear - 1);
                        if (lastInspection < lastYearWindow.start) {
                            targetYear = currentYear - 1;
                        } else {
                            targetYear = currentYear;
                        }
                    }
                }

                const targetWindow = getWindowForYear(targetYear);
                const msPerDay = 1000 * 60 * 60 * 24;
                
                let status = 'good';
                let statusText = '檢驗合格';
                let ringColor = "text-purple-500";
                let statusColor = "text-purple-400";
                let displayDays = 0;
                let labelText = "";

                if (today > targetWindow.end) {
                    status = 'expired';
                    statusText = '已逾期';
                    ringColor = "text-rose-500";
                    statusColor = "text-rose-500";
                    displayDays = Math.ceil((today - targetWindow.end) / msPerDay);
                    labelText = "已逾期天數";
                } else if (today >= targetWindow.start && today <= targetWindow.end) {
                    status = 'warning';
                    statusText = '檢驗期間';
                    ringColor = "text-yellow-400";
                    statusColor = "text-yellow-400";
                    displayDays = Math.ceil((targetWindow.end - today) / msPerDay);
                    labelText = "距離截止天數";
                } else {
                    status = 'good';
                    statusText = `下次檢驗: ${targetYear}年`;
                    ringColor = "text-purple-500";
                    statusColor = "text-purple-400";
                    displayDays = Math.ceil((targetWindow.start - today) / msPerDay);
                    labelText = "距離下次開始";
                }

                const totalYearDays = 365;
                let percent = 100;
                
                if (status === 'good') {
                    percent = (displayDays / totalYearDays) * 100;
                } else if (status === 'warning') {
                    percent = (displayDays / 90) * 100;
                } else {
                    percent = 100;
                }
                percent = Math.min(100, Math.max(0, percent));
                
                const circumference = 2 * Math.PI * 45; 
                const dashOffset = circumference - (percent / 100) * circumference;
                
                const windowStr = `${targetWindow.start.getMonth()+1}/${targetWindow.start.getDate()} ~ ${targetWindow.end.getMonth()+1}/${targetWindow.end.getDate()}`;

                return { 
                    displayDays, status, statusText, dashOffset, circumference, ringColor, statusColor,
                    labelText, windowStr, targetYear
                };
            };

            // --- Handlers ---

            const openFilterModal = (filter) => {
                setSelectedFilter(filter);
                setTempDate(filter.lastReplaced);
                setReplacerName(''); 
            };

            const handleFilterReplace = () => {
                if (!selectedFilter || !tempDate) return;
                const newFilters = filters.map(f => 
                    f.id === selectedFilter.id ? { ...f, lastReplaced: tempDate } : f
                );
                setFilters(newFilters);
                setFilterHistory([{ 
                    id: Date.now(), 
                    name: selectedFilter.name, 
                    date: tempDate, 
                    executor: replacerName || '使用者', 
                    type: 'filter' 
                }, ...filterHistory]);
                setSelectedFilter(null);
            };

            const openMotoModal = (scooter = null) => {
                if (scooter) {
                    setSelectedScooter(scooter);
                    setIsAddingScooter(false);
                    setTempOwner(scooter.owner);
                    setTempPlate(scooter.plateNumber);
                    setTempLicenseMonth(scooter.licenseMonth || 1);
                    setTempDate(scooter.lastInspection);
                } else {
                    setSelectedScooter(null);
                    setIsAddingScooter(true);
                    setTempOwner('');
                    setTempPlate('');
                    setTempLicenseMonth(1);
                    setTempDate(new Date().toISOString().split('T')[0]);
                }
                setShowMotoModal(true);
            };

            const handleMotoSave = () => {
                if (!tempOwner || !tempPlate) return;
                
                const scooterData = {
                    owner: tempOwner,
                    plateNumber: tempPlate,
                    licenseMonth: parseInt(tempLicenseMonth),
                    lastInspection: tempDate
                };

                if (isAddingScooter) {
                    setScooters([...scooters, { id: Date.now(), ...scooterData }]);
                } else {
                    setScooters(scooters.map(s => s.id === selectedScooter.id ? { ...s, ...scooterData } : s));
                    if (selectedScooter.lastInspection !== tempDate) {
                        setMotoHistory([{ 
                            id: Date.now(), 
                            name: `排氣定檢 (${tempPlate})`, 
                            date: tempDate, 
                            owner: tempOwner, 
                            plate: tempPlate, 
                            type: 'moto' 
                        }, ...motoHistory]);
                    }
                }
                setShowMotoModal(false);
            };

            const deleteHistory = (id, type) => {
                if (type === 'filter') setFilterHistory(filterHistory.filter(h => h.id !== id));
                else setMotoHistory(motoHistory.filter(h => h.id !== id));
            };

            const deleteVehicle = (id) => {
                if (confirm('確定要刪除這筆機車紀錄嗎？')) setScooters(scooters.filter(s => s.id !== id));
            };

            // --- Render Components ---

            const Header = () => {
                let icon, title, subtitle, color;
                if (activeTab === 'water') {
                    icon = <Icons.Droplets className="w-6 h-6 text-cyan-400" />;
                    title = "濾心監控";
                    subtitle = "RO System Status";
                    color = "bg-cyan-500/20";
                } else {
                    icon = <Icons.Bike className="w-6 h-6 text-purple-400" />;
                    title = "機車排氣";
                    subtitle = "Inspection Tracker";
                    color = "bg-purple-500/20";
                }
                return (
                    <header className="pt-8 pb-4 px-6 text-center sticky top-0 bg-slate-900/95 backdrop-blur z-20">
                        <div className="flex items-center justify-center gap-2 mb-2">
                            <div className={`p-2 rounded-full ${color}`}>{icon}</div>
                            <h1 className="text-white text-2xl font-bold tracking-wider">{title}</h1>
                        </div>
                        <p className="text-slate-400 text-xs uppercase tracking-widest">{subtitle}</p>
                    </header>
                );
            };

            const FilterCard = ({ filter }) => {
                const { daysRemaining, percent, status } = calculateFilterStatus(filter.lastReplaced, filter.lifespanMonths);
                let colorClass = "from-cyan-400 to-blue-600";
                let shadowClass = "shadow-cyan-500/20";
                if (status === 'warning') { colorClass = "from-yellow-300 to-amber-500"; shadowClass = "shadow-amber-500/20"; } 
                else if (status === 'expired') { colorClass = "from-red-400 to-rose-600"; shadowClass = "shadow-rose-500/20"; }

                return (
                    <button 
                        onClick={() => openFilterModal(filter)}
                        className={`relative group flex flex-col items-center bg-slate-800/50 hover:bg-slate-800 border border-slate-700 rounded-3xl p-4 transition-all duration-300 hover:scale-[1.02] shadow-xl ${shadowClass}`}
                    >
                        <div className="w-full flex justify-between items-start mb-3 z-10">
                            <span className="text-xs font-bold text-slate-400 bg-slate-900/50 px-2 py-1 rounded-md">#{filter.id}</span>
                            {status === 'expired' && <Icons.AlertTriangle className="w-4 h-4 text-rose-500 animate-pulse" />}
                        </div>
                        <div className="relative w-14 h-32 bg-slate-900/80 rounded-full border-2 border-slate-600 overflow-hidden mb-4 shadow-inner">
                            <div className="absolute bottom-0 left-0 w-full transition-all duration-1000 ease-in-out" style={{ height: `${percent}%` }}>
                                <div className={`w-full h-full opacity-80 bg-gradient-to-t ${colorClass} relative`}>
                                    <div className="absolute -top-3 left-0 w-[200%] h-6 bg-white/20 rounded-[50%] animate-wave"></div>
                                </div>
                            </div>
                        </div>
                        <div className="text-center z-10 w-full">
                            <h3 className="font-bold text-slate-100 text-sm mb-1 truncate">{filter.name}</h3>
                            <div className={`text-lg font-mono font-black ${status === 'expired' ? 'text-rose-400' : 'text-white'}`}>
                                {daysRemaining} <span className="text-xs font-normal text-slate-400">天</span>
                            </div>
                        </div>
                    </button>
                );
            };

            const MotoCard = ({ scooter }) => {
                const data = calculateMotoStatus(scooter.lastInspection, scooter.licenseMonth || 1);
                const { displayDays, status, statusText, dashOffset, circumference, ringColor, statusColor, labelText, windowStr, targetYear } = data;
                let borderColor = status === 'expired' ? "border-rose-500/30" : status === 'warning' ? "border-amber-500/30" : "border-slate-700";

                return (
                    <div className={`bg-slate-800 border ${borderColor} rounded-3xl p-5 shadow-2xl relative overflow-hidden transition-all hover:scale-[1.01]`}>
                        <div className="flex justify-between items-start mb-4 relative z-10">
                            <div>
                                <div className="flex items-center gap-2 text-slate-400 text-xs mb-1">
                                    <Icons.User className="w-3 h-3" /> {scooter.owner} 的機車
                                </div>
                                <h2 className="text-2xl font-bold text-white tracking-wider font-mono">{scooter.plateNumber}</h2>
                            </div>
                            <button onClick={() => deleteVehicle(scooter.id)} className="p-2 text-slate-600 hover:text-rose-500 transition-colors">
                                <Icons.Trash2 className="w-4 h-4" />
                            </button>
                        </div>
                        <div className="flex items-center gap-6">
                            <div className="relative w-28 h-28 flex-shrink-0">
                                <svg className="w-full h-full transform -rotate-90">
                                    <circle cx="50%" cy="50%" r="45%" className="stroke-slate-700 fill-none" strokeWidth="6" />
                                    <circle cx="50%" cy="50%" r="45%" className={`fill-none transition-all duration-1000 ease-out ${ringColor}`} strokeWidth="6" strokeLinecap="round" strokeDasharray={circumference} strokeDashoffset={dashOffset} />
                                </svg>
                                <div className="absolute inset-0 flex flex-col items-center justify-center">
                                    <span className={`text-3xl font-black ${statusColor} font-mono`}>{Math.max(0, Math.round(displayDays))}</span>
                                    <span className="text-[10px] text-slate-500 mt-1 text-center leading-tight px-1">{labelText}</span>
                                </div>
                            </div>
                            <div className="flex-1 space-y-3 z-10">
                                <div className={`text-sm font-bold flex items-center gap-1 ${statusColor}`}>
                                    {status === 'expired' || status === 'warning' ? <Icons.AlertTriangle className="w-4 h-4" /> : <Icons.CheckCircle2 className="w-4 h-4" />}
                                    {statusText}
                                </div>
                                <div className="text-xs space-y-1 text-slate-400">
                                    <div className="flex justify-between items-center bg-slate-900/50 p-1.5 rounded-lg border border-slate-700/50">
                                        <span className="flex items-center gap-1"><Icons.Calendar className="w-3 h-3"/> 發照月</span>
                                        <span className="font-mono text-white font-bold">{scooter.licenseMonth} 月</span>
                                    </div>
                                    <div className="flex justify-between pt-1">
                                        <span>上次檢驗:</span>
                                        <span className="font-mono text-slate-200">{scooter.lastInspection}</span>
                                    </div>
                                    <div className="flex justify-between items-center text-yellow-400/90">
                                        <span>{targetYear} 檢驗期:</span>
                                        <span className="font-mono text-white text-[10px]">{windowStr}</span>
                                    </div>
                                </div>
                                <button onClick={() => openMotoModal(scooter)} className="w-full py-2 bg-slate-700 hover:bg-purple-600 text-white text-xs font-bold rounded-lg transition-colors flex items-center justify-center gap-2">
                                    <Icons.PenTool className="w-3 h-3" /> 更新 / 編輯
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // --- Main Render ---

            return (
                <div className="min-h-screen text-white font-sans pb-24">
                    <Header />

                    <main className="max-w-md mx-auto px-4">
                        {/* RO Water Tab */}
                        {activeTab === 'water' && (
                            <div className="animate-in fade-in zoom-in duration-300">
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    {filters.map(filter => <FilterCard key={filter.id} filter={filter} />)}
                                </div>
                                <div className="bg-slate-800/30 rounded-2xl p-4 border border-slate-700/50">
                                    <div className="flex items-center gap-2 text-slate-400 text-sm mb-3">
                                        <Icons.History className="w-4 h-4" /> 最近更換紀錄
                                    </div>
                                    <div className="space-y-2 max-h-40 overflow-y-auto pr-1 custom-scrollbar">
                                        {filterHistory.length === 0 && <p className="text-xs text-slate-600 text-center py-2">無紀錄</p>}
                                        {filterHistory.map(h => (
                                            <div key={h.id} className="flex justify-between items-center text-xs text-slate-300 bg-slate-800 p-2 rounded-lg">
                                                <div>
                                                    <div className="font-medium text-slate-200">{h.name}</div>
                                                    <div className="flex items-center gap-2 opacity-60 mt-1">
                                                        <Icons.User className="w-3 h-3" /> <span>{h.executor}</span>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="opacity-60 font-mono">{h.date}</span>
                                                    <button onClick={() => deleteHistory(h.id, 'filter')} className="text-slate-600 hover:text-rose-500"><Icons.Trash2 className="w-3 h-3"/></button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Moto Tab */}
                        {activeTab === 'moto' && (
                            <div className="space-y-6 animate-in fade-in zoom-in duration-300">
                                {scooters.map(scooter => <MotoCard key={scooter.id} scooter={scooter} />)}
                                <button onClick={() => openMotoModal(null)} className="w-full py-4 border-2 border-dashed border-slate-700 text-slate-500 rounded-3xl flex items-center justify-center gap-2 hover:border-purple-500 hover:text-purple-400 transition-colors">
                                    <Icons.Plus className="w-5 h-5" /> 新增一台機車
                                </button>
                                <div className="bg-slate-800/30 rounded-2xl p-4 border border-slate-700/50 mt-6">
                                    <div className="flex items-center gap-2 text-slate-400 text-sm mb-3"><Icons.History className="w-4 h-4" /> 檢驗歷史</div>
                                    <div className="space-y-2 max-h-40 overflow-y-auto pr-1 custom-scrollbar">
                                        {motoHistory.length === 0 && <p className="text-xs text-slate-600 text-center py-2">尚無紀錄</p>}
                                        {motoHistory.map(h => (
                                            <div key={h.id} className="flex justify-between items-center text-xs text-slate-300 bg-slate-800 p-3 rounded-lg border border-slate-700/30">
                                                <div>
                                                    <div className="font-bold text-purple-400">定檢合格 ({h.plate})</div>
                                                    <div className="opacity-60 flex items-center gap-1 mt-0.5"><Icons.User className="w-2 h-2"/> {h.owner}</div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="font-mono opacity-60">{h.date}</span>
                                                    <button onClick={() => deleteHistory(h.id, 'moto')} className="text-slate-600 hover:text-rose-500"><Icons.Trash2 className="w-3 h-3"/></button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Bottom Nav */}
                    <nav className="fixed bottom-0 left-0 w-full bg-slate-800/90 backdrop-blur-md border-t border-slate-700 z-40 pb-safe">
                        <div className="max-w-md mx-auto flex justify-around p-2">
                            <button onClick={() => setActiveTab('water')} className={`flex flex-col items-center justify-center p-2 rounded-xl w-20 transition-all ${activeTab === 'water' ? 'text-cyan-400 bg-cyan-400/10' : 'text-slate-500 hover:text-slate-300'}`}>
                                <Icons.Droplets className={`w-6 h-6 mb-1 ${activeTab === 'water' ? 'fill-current' : ''}`} />
                                <span className="text-[10px] font-bold">淨水器</span>
                            </button>
                            <button onClick={() => setActiveTab('moto')} className={`flex flex-col items-center justify-center p-2 rounded-xl w-20 transition-all ${activeTab === 'moto' ? 'text-purple-400 bg-purple-400/10' : 'text-slate-500 hover:text-slate-300'}`}>
                                <Icons.Bike className={`w-6 h-6 mb-1 ${activeTab === 'moto' ? 'fill-current' : ''}`} />
                                <span className="text-[10px] font-bold">機車排氣</span>
                            </button>
                        </div>
                    </nav>

                    {/* Modals */}
                    {selectedFilter && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-slate-800 border border-slate-700 w-full max-w-sm rounded-3xl p-6 shadow-2xl relative">
                                <button onClick={() => setSelectedFilter(null)} className="absolute top-4 right-4 text-slate-400 hover:text-white"><Icons.X className="w-5 h-5"/></button>
                                <h2 className="text-xl font-bold text-white mb-1">{selectedFilter.name}</h2>
                                <p className="text-slate-400 text-sm mb-6">{selectedFilter.description}</p>
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-xs text-slate-400 block mb-1">更換日期</label>
                                        <input type="date" value={tempDate} onChange={(e) => setTempDate(e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-cyan-500 outline-none mb-3" />
                                        <label className="text-xs text-slate-400 block mb-1">更換人員 (備註)</label>
                                        <div className="relative">
                                            <Icons.User className="absolute left-3 top-3.5 w-4 h-4 text-slate-500" />
                                            <input type="text" placeholder="例如: 爸爸" value={replacerName} onChange={(e) => setReplacerName(e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded-xl pl-10 pr-4 py-3 text-white focus:border-cyan-500 outline-none" />
                                        </div>
                                    </div>
                                    <button onClick={handleFilterReplace} className="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl flex items-center justify-center gap-2">
                                        <Icons.RotateCcw className="w-4 h-4"/> 確認更換並儲存
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showMotoModal && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-slate-800 border border-slate-700 w-full max-w-sm rounded-3xl p-6 shadow-2xl relative">
                                <button onClick={() => setShowMotoModal(false)} className="absolute top-4 right-4 text-slate-400 hover:text-white"><Icons.X className="w-5 h-5"/></button>
                                <h2 className="text-xl font-bold text-white mb-1">{isAddingScooter ? '新增機車' : '更新機車狀態'}</h2>
                                <p className="text-slate-400 text-sm mb-6">依據行照發照月份自動計算檢驗期</p>
                                <div className="space-y-3">
                                    <div>
                                        <label className="text-xs text-slate-400 block mb-1">車主是誰</label>
                                        <input type="text" placeholder="例如: 媽媽" value={tempOwner} onChange={(e) => setTempOwner(e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-2 text-white focus:border-purple-500 outline-none" />
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-400 block mb-1">車牌號碼</label>
                                        <input type="text" placeholder="ABC-123" value={tempPlate} onChange={(e) => setTempPlate(e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-2 text-white focus:border-purple-500 outline-none" />
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-400 block mb-1 flex items-center gap-1"><Icons.Info className="w-3 h-3"/> 行照發照月份</label>
                                        <select value={tempLicenseMonth} onChange={(e) => setTempLicenseMonth(e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-2 text-white focus:border-purple-500 outline-none appearance-none">
                                            {[...Array(12)].map((_, i) => <option key={i+1} value={i+1}>{i+1} 月</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-400 block mb-1">最近一次檢驗日期</label>
                                        <input type="date" value={tempDate} onChange={(e) => setTempDate(e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 text-white focus:border-purple-500 outline-none" />
                                    </div>
                                    <button onClick={handleMotoSave} className="w-full py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl flex items-center justify-center gap-2 mt-2">
                                        <Icons.CheckCircle2 className="w-4 h-4"/> {isAddingScooter ? '新增車輛' : '更新紀錄'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
